<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>Mozilla InvestiGator: TimeDrift module</title>
<meta name="author" content="Julien Vehent &lt;jvehent&#64;mozilla.com&gt;" />
<style type="text/css">

body {
  width: 95%;
  max-width: 900px;
  margin: 20px;
  padding: 0;
  background: #151515 url("../images/bkg.png") 0 0;
  color: #eaeaea;
  font: 16px;
  line-height: 1.5;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
}

/* General & 'Reset' Stuff */

.container {
  width: 95%;
  max-width: 1000px;
  margin: 0 auto;
}

section {
  display: block;
  margin: 0 0 20px 0;
}

h1, h2, h3, h4, h5, h6 {
  /*margin: 0 0 20px;*/
  margin: 0;
}

li {
  line-height: 1.4 ;
}

/* Header, <header>
 *    header   - container
 *       h1       - project name
 *          h2       - project description
 *          */

header {
  background: rgba(0, 0, 0, 0.1);
  width: 100%;
  border-bottom: 1px dashed #b5e853;
  /*padding: 20px 0;
 *   margin: 0 0 40px 0;*/
  padding: 5px 0;
  margin: 0 0 10px 0;
}

header h1 {
  font-size: 30px;
  line-height: 1.5;
  margin: 0 0 0 -40px;
  font-weight: bold;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  /*color: #b5e853;*/
  color: #089d00;
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1),
               0 0 5px rgba(181, 232, 83, 0.1),
               0 0 10px rgba(181, 232, 83, 0.1);
  letter-spacing: -1px;
  -webkit-font-smoothing: antialiased;
}

header h1:before {
  content: "./ ";
  font-size: 24px;
}

header h2 {
  font-size: 18px;
  font-weight: 300;
  /*color: #666;*/
  color: #ff7800;
}

/* Main Content
 * */

#main_content {
  width: 100%;
  -webkit-font-smoothing: antialiased;
}
section img {
  max-width: 100%
}

h1, h2, h3, h4, h5, h6 {
  font-weight: normal;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  /*color: #b5e853;*/
  color: #8AB638;
  letter-spacing: -0.03em;
  /*text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1),
               0 0 5px rgba(181, 232, 83, 0.1),
               0 0 10px rgba(181, 232, 83, 0.1);*/
}

#main_content h1 {
  font-size: 30px;
}

#main_content h2 {
  font-size: 24px;
}

#main_content h3 {
  font-size: 18px;
}

#main_content h4 {
  font-size: 14px;
}

#main_content h5 {
  font-size: 12px;
  text-transform: uppercase;
  margin: 0 0 5px 0;
}

#main_content h6 {
  font-size: 12px;
  text-transform: uppercase;
  color: #999;
  margin: 0 0 5px 0;
}

dt {
  font-style: italic;
  font-weight: bold;
}
/*
ul li {
  list-style: none;
}
*/
/*
ul li:before {
  content: ">>";
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  font-size: 13px;
  color: #b5e853;
  margin-left: -37px;
  margin-right: 21px;
  line-height: 16px;
}
*/

blockquote {
  color: #aaa;
  padding-left: 10px;
  border-left: 1px dotted #666;
}


pre {
  background: rgba(0, 0, 0, 0.9);
  border: 1px solid rgba(255, 255, 255, 0.15);
  padding: 10px;
  font-size: 14px;
  //color: #b5e853;
  border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-border-radius: 2px;
  text-wrap: normal;
  overflow: auto;
  overflow-y: hidden;
}

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
//pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment, code .c1 { color: #FF7428; }
code, pre.code .keyword, code .keyword, pre.code .kd, pre.code .kn, pre.code .k, pre.code .o { color: #00a5ff; font-weight: bold;}
pre.code .nb { color: #c45918;}
pre.code .s {color: #0a77c4;}
pre.code .punctuation, pre.code .punctuation, pre.code .p { color: white;}
pre.code .literal.string, pre.code .literal.string { color: #40BF32; }
pre.code .name.builtin, pre.code .name.builtin, pre.code .nx { color: white; }
pre.code .deleted, pre.code .deleted { background-color: #DEB0A1}
pre.code .inserted, pre.code .inserted { background-color: #A3D289}

table {
  width: 100%;
  margin: 0 0 20px 0;
}

th {
  text-align: left;
  border-bottom: 1px dashed #b5e853;
  padding: 5px 10px;
}

td {
  padding: 5px 10px;
}

hr {
  height: 0;
  border: 0;
  border-bottom: 1px dashed #b5e853;
  color: #b5e853;
}
/* Links
 *    a, a:hover, a:visited
 *    */

a {
  color: #63c0f5;
  text-shadow: 0 0 5px rgba(104, 182, 255, 0.5);
}

cite {
  color: #00FF4A;
}

strong {
  color: #C64216;
}

</style>
</head>
<body>
<div class="document" id="mozilla-investigator-timedrift-module">
<h1 class="title">Mozilla InvestiGator: TimeDrift module</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Julien Vehent &lt;<a class="reference external" href="mailto:jvehent&#64;mozilla.com">jvehent&#64;mozilla.com</a>&gt;</td></tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#usage" id="id1">1&nbsp;&nbsp;&nbsp;Usage</a></li>
<li><a class="reference internal" href="#examples" id="id2">2&nbsp;&nbsp;&nbsp;Examples</a><ul class="auto-toc">
<li><a class="reference internal" href="#endpoint-non-compliant-with-a-10-millisecond-drift" id="id3">2.1&nbsp;&nbsp;&nbsp;Endpoint non-compliant with a 10 millisecond drift</a></li>
<li><a class="reference internal" href="#endpoint-compliant-with-a-5-seconds-drift" id="id4">2.2&nbsp;&nbsp;&nbsp;Endpoint compliant with a 5 seconds drift</a></li>
<li><a class="reference internal" href="#get-localtime-from-endpoint" id="id5">2.3&nbsp;&nbsp;&nbsp;Get localtime from endpoint</a></li>
</ul>
</li>
</ul>
</div>
<p>The timedrift module evaluates the current time on a given endpoint against the
time retrieved from a list of NTP servers. If the -drift parameter is passed,
the module checks that the endpoint's time is within or without the drift
window.</p>
<p>When evaluating drift, the module returns FoundAnything=true for endpoints that
have drifted beyond the accepted value, and for which the local time is out of
sync compared with NTP servers.</p>
<div class="section" id="usage">
<h1><a class="toc-backref" href="#id1">1&nbsp;&nbsp;&nbsp;Usage</a></h1>
<p>timedrift can be called with empty parameters, and then only returns the local
time of the target endpoint. When called with a drift parameter, NTP
connections are established to evaluated the local time against network time.</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;module&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;timedrift&quot;</span><span class="punctuation">,</span>
  <span class="name tag">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;drift&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;5s&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id2">2&nbsp;&nbsp;&nbsp;Examples</a></h1>
<div class="section" id="endpoint-non-compliant-with-a-10-millisecond-drift">
<h2><a class="toc-backref" href="#id3">2.1&nbsp;&nbsp;&nbsp;Endpoint non-compliant with a 10 millisecond drift</a></h2>
<p>Evaluating a 10ms drift is not useful, because the latency between the
endpoint and the NTP servers is most likely greater than 10ms, and
endpoint would always fail that test. But it illustrates the output
from an endpoint that has drifted beyond the acceptable value.</p>
<pre class="code literal-block">
$ mig timedrift -t &quot;name='somehost.example.net'&quot; -show all -drift 10ms 2&gt;/dev/null
stat: execution time 252.902127ms
somehost.example.net local time is 2015-03-14T13:26:27.441740604-04:00
somehost.example.net local time is out of sync from NTP servers
somehost.example.net Local time is ahead of ntp host 0.pool.ntp.org by 17.731324ms
somehost.example.net Local time is ahead of ntp host 1.pool.ntp.org by 16.542859ms
somehost.example.net Local time is ahead of ntp host 2.pool.ntp.org by 20.853337ms
somehost.example.net Local time is ahead of ntp host 3.pool.ntp.org by 33.743419ms
somehost.example.net stat: 0.pool.ntp.org responded in 44.26132ms with time 2015-03-14 17:26:27.473289999 +0000 UTC. local time drifts by 17.731324ms
somehost.example.net stat: 1.pool.ntp.org responded in 38.263502ms with time 2015-03-14 17:26:27.520487097 +0000 UTC. local time drifts by 16.542859ms
somehost.example.net stat: 2.pool.ntp.org responded in 46.682002ms with time 2015-03-14 17:26:27.576307275 +0000 UTC. local time drifts by 20.853337ms
somehost.example.net stat: 3.pool.ntp.org responded in 83.492232ms with time 2015-03-14 17:26:27.660943187 +0000 UTC. local time drifts by 33.743419ms
somehost.example.net command success
</pre>
</div>
<div class="section" id="endpoint-compliant-with-a-5-seconds-drift">
<h2><a class="toc-backref" href="#id4">2.2&nbsp;&nbsp;&nbsp;Endpoint compliant with a 5 seconds drift</a></h2>
<pre class="code literal-block">
$ mig timedrift -t &quot;name='somehost.example.net'&quot; -show all -drift 5s 2&gt;/dev/null
stat: execution time 1.76047894s
somehost.example.net local time is 2015-03-14T13:26:10.764244879-04:00
somehost.example.net local time is within acceptable drift from NTP servers
somehost.example.net stat: 0.pool.ntp.org responded in 44.574857ms with time 2015-03-14 17:26:10.996919999 +0000 UTC. local time drifts by 17.557879ms
somehost.example.net stat: 1.pool.ntp.org responded in 38.52106ms with time 2015-03-14 17:26:12.139883892 +0000 UTC. local time drifts by 16.917595ms
somehost.example.net stat: 2.pool.ntp.org responded in 46.79544ms with time 2015-03-14 17:26:12.38555022 +0000 UTC. local time drifts by 20.839501ms
somehost.example.net stat: 3.pool.ntp.org responded in 82.798078ms with time 2015-03-14 17:26:12.490975185 +0000 UTC. local time drifts by 33.808416ms
somehost.example.net command success
</pre>
</div>
<div class="section" id="get-localtime-from-endpoint">
<h2><a class="toc-backref" href="#id5">2.3&nbsp;&nbsp;&nbsp;Get localtime from endpoint</a></h2>
<pre class="code literal-block">
$ mig timedrift -t &quot;name='somehost.example.net'&quot; 2&gt;/dev/null
somehost.example.net local time is 2015-03-14T13:32:24.226318523-04:00
</pre>
</div>
</div>
</div>
</body>
</html>
