<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>MIG API</title>
<meta name="author" content="Julien Vehent &lt;jvehent&#64;mozilla.com&gt;" />
<style type="text/css">

body {
  width: 95%;
  max-width: 900px;
  margin: 20px;
  padding: 0;
  background: #151515 url("../images/bkg.png") 0 0;
  color: #eaeaea;
  font: 16px;
  line-height: 1.5;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
}

/* General & 'Reset' Stuff */

.container {
  width: 95%;
  max-width: 1000px;
  margin: 0 auto;
}

section {
  display: block;
  margin: 0 0 20px 0;
}

h1, h2, h3, h4, h5, h6 {
  /*margin: 0 0 20px;*/
  margin: 0;
}

li {
  line-height: 1.4 ;
}

/* Header, <header>
 *    header   - container
 *       h1       - project name
 *          h2       - project description
 *          */

header {
  background: rgba(0, 0, 0, 0.1);
  width: 100%;
  border-bottom: 1px dashed #b5e853;
  /*padding: 20px 0;
 *   margin: 0 0 40px 0;*/
  padding: 5px 0;
  margin: 0 0 10px 0;
}

header h1 {
  font-size: 30px;
  line-height: 1.5;
  margin: 0 0 0 -40px;
  font-weight: bold;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  /*color: #b5e853;*/
  color: #089d00;
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1),
               0 0 5px rgba(181, 232, 83, 0.1),
               0 0 10px rgba(181, 232, 83, 0.1);
  letter-spacing: -1px;
  -webkit-font-smoothing: antialiased;
}

header h1:before {
  content: "./ ";
  font-size: 24px;
}

header h2 {
  font-size: 18px;
  font-weight: 300;
  /*color: #666;*/
  color: #ff7800;
}

/* Main Content
 * */

#main_content {
  width: 100%;
  -webkit-font-smoothing: antialiased;
}
section img {
  max-width: 100%
}

h1, h2, h3, h4, h5, h6 {
  font-weight: normal;
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  /*color: #b5e853;*/
  color: #8AB638;
  letter-spacing: -0.03em;
  /*text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1),
               0 0 5px rgba(181, 232, 83, 0.1),
               0 0 10px rgba(181, 232, 83, 0.1);*/
}

#main_content h1 {
  font-size: 30px;
}

#main_content h2 {
  font-size: 24px;
}

#main_content h3 {
  font-size: 18px;
}

#main_content h4 {
  font-size: 14px;
}

#main_content h5 {
  font-size: 12px;
  text-transform: uppercase;
  margin: 0 0 5px 0;
}

#main_content h6 {
  font-size: 12px;
  text-transform: uppercase;
  color: #999;
  margin: 0 0 5px 0;
}

dt {
  font-style: italic;
  font-weight: bold;
}
/*
ul li {
  list-style: none;
}
*/
/*
ul li:before {
  content: ">>";
  font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
  font-size: 13px;
  color: #b5e853;
  margin-left: -37px;
  margin-right: 21px;
  line-height: 16px;
}
*/

blockquote {
  color: #aaa;
  padding-left: 10px;
  border-left: 1px dotted #666;
}


pre {
  background: rgba(0, 0, 0, 0.9);
  border: 1px solid rgba(255, 255, 255, 0.15);
  padding: 10px;
  font-size: 14px;
  //color: #b5e853;
  border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-border-radius: 2px;
  text-wrap: normal;
  overflow: auto;
  overflow-y: hidden;
}

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
//pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment, code .c1 { color: #FF7428; }
code, pre.code .keyword, code .keyword, pre.code .kd, pre.code .kn, pre.code .k, pre.code .o { color: #00a5ff; font-weight: bold;}
pre.code .nb { color: #c45918;}
pre.code .s {color: #0a77c4;}
pre.code .punctuation, pre.code .punctuation, pre.code .p { color: white;}
pre.code .literal.string, pre.code .literal.string { color: #40BF32; }
pre.code .name.builtin, pre.code .name.builtin, pre.code .nx { color: white; }
pre.code .deleted, pre.code .deleted { background-color: #DEB0A1}
pre.code .inserted, pre.code .inserted { background-color: #A3D289}

table {
  width: 100%;
  margin: 0 0 20px 0;
}

th {
  text-align: left;
  border-bottom: 1px dashed #b5e853;
  padding: 5px 10px;
}

td {
  padding: 5px 10px;
}

hr {
  height: 0;
  border: 0;
  border-bottom: 1px dashed #b5e853;
  color: #b5e853;
}
/* Links
 *    a, a:hover, a:visited
 *    */

a {
  color: #63c0f5;
  text-shadow: 0 0 5px rgba(104, 182, 255, 0.5);
}

cite {
  color: #00FF4A;
}

strong {
  color: #C64216;
}

</style>
</head>
<body>
<div class="document" id="mig-api">
<h1 class="title">MIG API</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Julien Vehent &lt;<a class="reference external" href="mailto:jvehent&#64;mozilla.com">jvehent&#64;mozilla.com</a>&gt;</td></tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#authentication-with-x-pgpauthorization-version-1" id="id1">1&nbsp;&nbsp;&nbsp;Authentication with X-PGPAUTHORIZATION version 1</a><ul class="auto-toc">
<li><a class="reference internal" href="#security-implications" id="id2">1.1&nbsp;&nbsp;&nbsp;Security implications</a></li>
<li><a class="reference internal" href="#example-1-invalid-timestamp" id="id3">1.2&nbsp;&nbsp;&nbsp;Example 1: invalid timestamp</a></li>
<li><a class="reference internal" href="#example-2-invalid-signature" id="id4">1.3&nbsp;&nbsp;&nbsp;Example 2: invalid signature</a></li>
<li><a class="reference internal" href="#generating-a-token-in-bash" id="id5">1.4&nbsp;&nbsp;&nbsp;Generating a token in Bash</a></li>
<li><a class="reference internal" href="#generating-a-token-in-python" id="id6">1.5&nbsp;&nbsp;&nbsp;Generating a token in Python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-endpoints" id="id7">2&nbsp;&nbsp;&nbsp;API endpoints</a><ul class="auto-toc">
<li><a class="reference internal" href="#get-api-v1-heartbeat" id="id8">2.1&nbsp;&nbsp;&nbsp;GET /api/v1/heartbeat</a></li>
<li><a class="reference internal" href="#get-api-v1-ip" id="id9">2.2&nbsp;&nbsp;&nbsp;GET /api/v1/ip</a></li>
<li><a class="reference internal" href="#get-api-v1-dashboard" id="id10">2.3&nbsp;&nbsp;&nbsp;GET /api/v1/dashboard</a></li>
<li><a class="reference internal" href="#get-api-v1-action" id="id11">2.4&nbsp;&nbsp;&nbsp;GET /api/v1/action</a></li>
<li><a class="reference internal" href="#post-api-v1-action-create" id="id12">2.5&nbsp;&nbsp;&nbsp;POST /api/v1/action/create/</a></li>
<li><a class="reference internal" href="#get-api-v1-agent" id="id13">2.6&nbsp;&nbsp;&nbsp;GET /api/v1/agent</a></li>
<li><a class="reference internal" href="#get-api-v1-command" id="id14">2.7&nbsp;&nbsp;&nbsp;GET /api/v1/command</a></li>
<li><a class="reference internal" href="#get-api-v1-investigator" id="id15">2.8&nbsp;&nbsp;&nbsp;GET /api/v1/investigator</a></li>
<li><a class="reference internal" href="#post-api-v1-investigator-create" id="id16">2.9&nbsp;&nbsp;&nbsp;POST /api/v1/investigator/create/</a></li>
<li><a class="reference internal" href="#post-api-v1-investigator-update" id="id17">2.10&nbsp;&nbsp;&nbsp;POST /api/v1/investigator/update/</a></li>
<li><a class="reference internal" href="#get-api-v1-search" id="id18">2.11&nbsp;&nbsp;&nbsp;GET /api/v1/search</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-transformation" id="id19">3&nbsp;&nbsp;&nbsp;Data transformation</a><ul class="auto-toc">
<li><a class="reference internal" href="#compliance-items" id="id20">3.1&nbsp;&nbsp;&nbsp;Compliance Items</a></li>
<li><a class="reference internal" href="#geolocations" id="id21">3.2&nbsp;&nbsp;&nbsp;Geolocations</a></li>
</ul>
</li>
</ul>
</div>
<p>Interactions between an investigator (a human being) and the MIG platform are
performed through a REST API. The API exposes functions to create actions,
retrieve results, and generally monitor the activity of the agents.</p>
<p>The API follows the core principles of REST, and provides discoverable
endpoints. API responses follows the <strong>cljs</strong> format defined in
<a class="reference external" href="http://amundsen.com/media-types/collection/">Collection+JSON - Hypermedia Type</a>.</p>
<div class="section" id="authentication-with-x-pgpauthorization-version-1">
<h1><a class="toc-backref" href="#id1">1&nbsp;&nbsp;&nbsp;Authentication with X-PGPAUTHORIZATION version 1</a></h1>
<p>Authenticating against the MIG API requires sending a PGP signed token in the
request header named <cite>X-PGPAUTHORIZATION</cite>. The key that signs the token must
belong to an active investigator. Construction of the token works as follows:</p>
<ol class="arabic">
<li><p class="first">make a string named <strong>str</strong> composed of a version, a UTC timestamp in RFC3339 format
and a random nonce, each separated by semicolons. The current version is <strong>1</strong>
and may be upgraded in the future. The nonce value must be a positive integer.</p>
<p><strong>str=&lt;VERSION&gt;;&lt;UTC TIMESTAMP RFC3339&gt;;&lt;NONCE&gt;</strong></p>
<p>UTC is a hard requirement. The timestamp must end with the suffix <strong>Z</strong>
which indicates the UTC timezone. In bash, a correct timestamp can be
generated with the command <cite>$ date -u +%Y-%m-%dT%H:%M:%SZ</cite>.</p>
<p>An example string would look like: <cite>1;2006-01-02T15:04:05Z;1825922807490630059</cite></p>
<p>The string must be terminated by a newline character, hexadecimal code <cite>0x0a</cite>.</p>
</li>
</ol>
<pre class="code bash literal-block">
<span class="name variable">$ </span>hexdump -C <span class="operator">&lt;&lt;&lt;</span> <span class="literal string single">'1;2006-01-02T15:04:05Z;1825922807490630059'</span>
<span class="literal number">00000000</span>  <span class="literal number">31</span> 3b <span class="literal number">32</span> <span class="literal number">30</span> <span class="literal number">30</span> <span class="literal number">36</span> 2d <span class="literal number">30</span>  <span class="literal number">31</span> 2d <span class="literal number">30</span> <span class="literal number">32</span> <span class="literal number">54</span> <span class="literal number">31</span> <span class="literal number">35</span> 3a  <span class="punctuation">|</span>1<span class="punctuation">;</span>2006-01-02T15:<span class="punctuation">|</span>
<span class="literal number">00000010</span>  <span class="literal number">30</span> <span class="literal number">34</span> 3a <span class="literal number">30</span> <span class="literal number">35</span> 5a 3b <span class="literal number">31</span>  <span class="literal number">38</span> <span class="literal number">32</span> <span class="literal number">35</span> <span class="literal number">39</span> <span class="literal number">32</span> <span class="literal number">32</span> <span class="literal number">38</span> <span class="literal number">30</span>  <span class="punctuation">|</span>04:05Z<span class="punctuation">;</span>182592280<span class="punctuation">|</span>
<span class="literal number">00000020</span>  <span class="literal number">37</span> <span class="literal number">34</span> <span class="literal number">39</span> <span class="literal number">30</span> <span class="literal number">36</span> <span class="literal number">33</span> <span class="literal number">30</span> <span class="literal number">30</span>  <span class="literal number">35</span> <span class="literal number">39</span> 0a                 <span class="punctuation">|</span>7490630059.<span class="punctuation">|</span>
0000002b
</pre>
<ol class="arabic" start="2">
<li><p class="first">PGP sign <strong>str</strong> with the private key of the investigator. Armor and detach
the signature into <strong>armoredSig</strong>:</p>
<pre class="literal-block">
$ gpg -a --detach-sig &lt;&lt;&lt; '1;2006-01-02T15:04:05Z;1825922807490630059'

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAABCAAGBQJUZ5psAAoJEKPWUhc7dj6PFd8IALWQS4x9Kzssww1pxc7uq9mg
JT/3jHLwAYPQV3ltqFcI5R2EGHo5DsXXjX6lfOc7DgbteB9UV+H++KG0oVUTTjuP
kncmFYmoBEDqbXju6EASBLyUlt3M43N9DmQaAaeoyW2gB0p0aEYRZoN3Cf0O0qhU
b3nnsCz6IyuBcQAZh1Jnmf7AMwRmXier8OflObQ9wJ1iYF9KCD0TgP1Z+kaCvMqC
PWQ5XaNaXn665V19mjAMicOtO9U3A/v4ApYyUSPyq0cuLrT8z/Z1vdjyeZVTaOM8
MhnoKfgBnegQnP+BPQZlWcjaBsquenC/joYRhq20nAEwSjZ1Nm7+qHo/DW0bYOA=
=4nrR
-----END PGP SIGNATURE-----
</pre>
</li>
<li><p class="first">Create <strong>sig</strong> by taking <strong>armoredSig</strong> and removing the PGP headers, footers,
empty lines and newlines.</p>
<blockquote>
<p>example: <cite>iQEcBAABCAAGBQJUWPDpAAoJEKPWUhc7dj6PQdgH/0TRMOEAL4SL6v+JvixWtEGJzXBCqBpRBsygHAKT+m4AxwniVa9vr8vfWm14eFpZTGdlDx39Ko+tdFoHn5Z1yKEeQWEQYXqhneAnv0pYR1aIjXM8MY63TNePWBZxUerlRkjv2IH16/W5aBrbOctOxEs1BKuN2pd4Hgubr+2f43gcRcWW+Ww/5Fyg1lKzH8jP84uqiIT8wQOdBrwUkgRdSdfMQbYFjsgY57G+ZsMobNhhlFedgKuZShJCd+G1GlwsfZPsZOSLmVZahI7wjR3vckCJ66eff3e/xX7Gt0zGGa5i1dgH5Q6TSjRGRBE37FwD4C6fycUEuy9yKI7iFziw33Y==k6gT</cite></p>
</blockquote>
</li>
<li><p class="first">Create <strong>token</strong> by concatenating <strong>str</strong>, a semicolon, and <strong>sig</strong>.
<strong>token=&lt;str&gt;;&lt;sig&gt;</strong>
example: <cite>1;2006-01-02T15:04:05Z;1825922807490630059;owEBYQGe/pANAwAIAaPWUhc7dj6...&lt;truncated&gt;</cite></p>
</li>
<li><p class="first">Send <strong>token</strong> in the header named <strong>X-PGPAUTHORIZATION</strong> with the request:</p>
<pre class="literal-block">
$ curl -H 'X-PGPAUTHORIZATION: 1;2006-01-02T15:04:05Z;1825922807490630059;owEBYQGe/pANAwAIAaP...&lt;truncated&gt;' localhost:12345/api/v1/
</pre>
</li>
<li><p class="first">The API verifies the version and validity period of the timestamp. By default, a
token will be rejected if its timestamp deviates from the server time by more
than 10 minutes. Administrators can configure this value. In effect, this
means a timestamp is valid for twice the duration of the window. By default,
that's 10 minutes before current server time, and 10 minutes after current
server time.</p>
</li>
<li><p class="first">If the timestamp is valid, the API next verifies the signature against the data
and authenticates the user. Failure to verify the signature returns an error
with the HTTP code 401 Unauthorized.</p>
</li>
<li><p class="first">The user is authorized, the API processes and answer the request.</p>
</li>
</ol>
<div class="section" id="security-implications">
<h2><a class="toc-backref" href="#id2">1.1&nbsp;&nbsp;&nbsp;Security implications</a></h2>
<ol class="arabic simple">
<li>A token can be used an unlimited number of times within its validity period.
There is no check to guarantee that a token is only used once. It is
assumed that the token is transmitted over a secure channel such as HTTPS to
prevent token theft by a malicious user.</li>
<li>API clients and servers must use proper time synchronization for the timestamp
verification to work. A client or a server that has inaccurate time may not be
able to establish connections. We believe this requirement to be reasonable
considering the sensitivity of the API.</li>
</ol>
</div>
<div class="section" id="example-1-invalid-timestamp">
<h2><a class="toc-backref" href="#id3">1.2&nbsp;&nbsp;&nbsp;Example 1: invalid timestamp</a></h2>
<p>The signature is valid but the timestamp is beyond the acceptable time window.</p>
<pre class="code bash literal-block">
<span class="name variable">$ </span>curl -H <span class="literal string single">'X-PGPAUTHORIZATION: 1;2006-01-02T15:04:05Z;1825922807490630059;iQEcB...&lt;truncated&gt;'</span> http://localhost:12345/api/v1/

<span class="operator">{</span>
        <span class="literal string double">&quot;collection&quot;</span>: <span class="operator">{</span>
                <span class="literal string double">&quot;error&quot;</span>: <span class="operator">{</span>
                        <span class="literal string double">&quot;code&quot;</span>: <span class="literal string double">&quot;6077873045059431424&quot;</span>,
                        <span class="literal string double">&quot;message&quot;</span>: <span class="literal string double">&quot;Authorization verification failed with error 'verifySignedToken() -&gt; token timestamp is not within acceptable time limits'&quot;</span>
                <span class="operator">}</span>,
                <span class="literal string double">&quot;href&quot;</span>: <span class="literal string double">&quot;http://localhost:12345/api/v1/&quot;</span>,
                <span class="literal string double">&quot;template&quot;</span>: <span class="operator">{}</span>,
                <span class="literal string double">&quot;version&quot;</span>: <span class="literal string double">&quot;1.0&quot;</span>
        <span class="operator">}</span>
<span class="operator">}</span>
</pre>
</div>
<div class="section" id="example-2-invalid-signature">
<h2><a class="toc-backref" href="#id4">1.3&nbsp;&nbsp;&nbsp;Example 2: invalid signature</a></h2>
<p>The signature is not valid, or is signed by a key that the API does not
recognize.</p>
<pre class="code bash literal-block">
<span class="name variable">$ </span>curl -H <span class="literal string single">'X-PGPAUTHORIZATION: 1;2014-11-04T15:36:05Z;1825922807490630059;iQEcBA...&lt;truncated&gt;'</span> http://localhost:12345/api/v1/

<span class="operator">{</span>
        <span class="literal string double">&quot;collection&quot;</span>: <span class="operator">{</span>
                <span class="literal string double">&quot;error&quot;</span>: <span class="operator">{</span>
                        <span class="literal string double">&quot;code&quot;</span>: <span class="literal string double">&quot;6077875007260332032&quot;</span>,
                        <span class="literal string double">&quot;message&quot;</span>: <span class="literal string double">&quot;Authorization verification failed with error 'verifySignedToken() -&gt; GetFingerprintFromSignature() -&gt; openpgp: invalid signature: hash tag doesn't match'&quot;</span>
                <span class="operator">}</span>,
                <span class="literal string double">&quot;href&quot;</span>: <span class="literal string double">&quot;http://localhost:12345/api/v1/&quot;</span>,
                <span class="literal string double">&quot;template&quot;</span>: <span class="operator">{}</span>,
                <span class="literal string double">&quot;version&quot;</span>: <span class="literal string double">&quot;1.0&quot;</span>
        <span class="operator">}</span>
<span class="operator">}</span>
</pre>
</div>
<div class="section" id="generating-a-token-in-bash">
<h2><a class="toc-backref" href="#id5">1.4&nbsp;&nbsp;&nbsp;Generating a token in Bash</a></h2>
<pre class="code literal-block">
$ token=&quot;1;$(date -u +%Y-%m-%dT%H:%M:%SZ);$RANDOM$RANDOM$RANDOM$RANDOM&quot;; \
sig=$(gpg -a --detach-sig &lt;&lt;&lt; $token |tail -8 |head -7 \
| sed ':a;N;$!ba;s/\n//g'); echo &quot;X-PGPAUTHORIZATION: $token;$sig&quot;

X-PGPAUTHORIZATION: 1;2014-11-04T19:13:37Z;13094113753132512760;iQEcBAA.....
</pre>
</div>
<div class="section" id="generating-a-token-in-python">
<h2><a class="toc-backref" href="#id6">1.5&nbsp;&nbsp;&nbsp;Generating a token in Python</a></h2>
<pre class="code python literal-block">
<span class="comment">#!/usr/bin/env python</span>
<span class="keyword namespace">import</span> <span class="name namespace">os</span>
<span class="keyword namespace">import</span> <span class="name namespace">gnupg</span>
<span class="keyword namespace">from</span> <span class="name namespace">time</span> <span class="keyword namespace">import</span> <span class="name">gmtime</span><span class="punctuation">,</span> <span class="name">strftime</span>
<span class="keyword namespace">import</span> <span class="name namespace">random</span>
<span class="keyword namespace">import</span> <span class="name namespace">requests</span>
<span class="keyword namespace">import</span> <span class="name namespace">json</span>

<span class="keyword">def</span> <span class="name function">makeToken</span><span class="punctuation">(</span><span class="name">gpghome</span><span class="punctuation">,</span> <span class="name">keyid</span><span class="punctuation">):</span>
        <span class="name">gpg</span> <span class="operator">=</span> <span class="name">gnupg</span><span class="operator">.</span><span class="name">GPG</span><span class="punctuation">(</span><span class="name">gnupghome</span><span class="operator">=</span><span class="name">gpghome</span><span class="punctuation">)</span>
        <span class="name">version</span> <span class="operator">=</span> <span class="literal string">&quot;1&quot;</span>
        <span class="name">timestamp</span> <span class="operator">=</span> <span class="name">strftime</span><span class="punctuation">(</span><span class="literal string">&quot;%Y-%m-</span><span class="literal string interpol">%d</span><span class="literal string">T%H:%M:%SZ&quot;</span><span class="punctuation">,</span> <span class="name">gmtime</span><span class="punctuation">())</span>
        <span class="name">nonce</span> <span class="operator">=</span> <span class="name builtin">str</span><span class="punctuation">(</span><span class="name">random</span><span class="operator">.</span><span class="name">randint</span><span class="punctuation">(</span><span class="literal number integer">10000</span><span class="punctuation">,</span> <span class="literal number integer">18446744073709551616</span><span class="punctuation">))</span>
        <span class="name">token</span> <span class="operator">=</span> <span class="name">version</span> <span class="operator">+</span> <span class="literal string">&quot;;&quot;</span> <span class="operator">+</span> <span class="name">timestamp</span> <span class="operator">+</span> <span class="literal string">&quot;;&quot;</span> <span class="operator">+</span> <span class="name">nonce</span>
        <span class="name">sig</span> <span class="operator">=</span> <span class="name">gpg</span><span class="operator">.</span><span class="name">sign</span><span class="punctuation">(</span><span class="name">token</span> <span class="operator">+</span> <span class="literal string">&quot;</span><span class="literal string escape">\n</span><span class="literal string">&quot;</span><span class="punctuation">,</span>
                <span class="name">keyid</span><span class="operator">=</span><span class="name">keyid</span><span class="punctuation">,</span>
                <span class="name">detach</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">,</span> <span class="name">clearsign</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span>
        <span class="name">token</span> <span class="operator">+=</span> <span class="literal string">&quot;;&quot;</span>
        <span class="name">linectr</span><span class="operator">=</span><span class="literal number integer">0</span>
        <span class="keyword">for</span> <span class="name">line</span> <span class="operator word">in</span> <span class="name builtin">iter</span><span class="punctuation">(</span><span class="name builtin">str</span><span class="punctuation">(</span><span class="name">sig</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">splitlines</span><span class="punctuation">()):</span>
                <span class="name">linectr</span><span class="operator">+=</span><span class="literal number integer">1</span>
                <span class="keyword">if</span> <span class="name">linectr</span> <span class="operator">&lt;</span> <span class="literal number integer">4</span> <span class="operator word">or</span> <span class="name">line</span><span class="operator">.</span><span class="name">startswith</span><span class="punctuation">(</span><span class="literal string">'-'</span><span class="punctuation">)</span> <span class="operator word">or</span> <span class="operator word">not</span> <span class="name">line</span><span class="punctuation">:</span>
                        <span class="keyword">continue</span>
                <span class="name">token</span> <span class="operator">+=</span> <span class="name">line</span>
        <span class="keyword">return</span> <span class="name">token</span>

<span class="keyword">if</span> <span class="name">__name__</span> <span class="operator">==</span> <span class="literal string">'__main__'</span><span class="punctuation">:</span>
        <span class="name">token</span> <span class="operator">=</span> <span class="name">makeToken</span><span class="punctuation">(</span><span class="literal string">&quot;/home/ulfr/.gnupg&quot;</span><span class="punctuation">,</span>
                <span class="literal string">&quot;E60892BB9BD89A69F759A1A0A3D652173B763E8F&quot;</span><span class="punctuation">)</span>
        <span class="name">r</span> <span class="operator">=</span> <span class="name">requests</span><span class="operator">.</span><span class="name">get</span><span class="punctuation">(</span><span class="literal string">&quot;http://localhost:12345/api/v1/dashboard&quot;</span><span class="punctuation">,</span>
                <span class="name">headers</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string">'X-PGPAUTHORIZATION'</span><span class="punctuation">:</span> <span class="name">token</span><span class="punctuation">})</span>
        <span class="keyword">print</span> <span class="name">token</span>
        <span class="keyword">print</span> <span class="name">r</span><span class="operator">.</span><span class="name">text</span>
</pre>
</div>
</div>
<div class="section" id="api-endpoints">
<h1><a class="toc-backref" href="#id7">2&nbsp;&nbsp;&nbsp;API endpoints</a></h1>
<p>The API root is at <cite>/api/v1</cite> by defualt. All the endpoints described below are
reachable behind the root. If you change the location of the API root, update
the query paths accordingly.</p>
<div class="section" id="get-api-v1-heartbeat">
<h2><a class="toc-backref" href="#id8">2.1&nbsp;&nbsp;&nbsp;GET /api/v1/heartbeat</a></h2>
<ul class="simple">
<li>Description: basic endpoint that returns a HTTP 200</li>
<li>Parameters: none</li>
<li>Authentication: none</li>
<li>Response Code: 200 OK</li>
<li>Reponse: Collection+JSON</li>
</ul>
<pre class="code json literal-block">
<span class="punctuation">{</span>
        <span class="name tag">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                <span class="name tag">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
                <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.mozilla.org/api/v1/heartbeat&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                        <span class="punctuation">{</span>
                                <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                        <span class="punctuation">{</span>
                                                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;heartbeat&quot;</span><span class="punctuation">,</span>
                                                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;gatorz say hi&quot;</span>
                                        <span class="punctuation">}</span>
                                <span class="punctuation">],</span>
                                <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;/api/v1/heartbeat&quot;</span>
                        <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
                <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;1.0&quot;</span>
        <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="get-api-v1-ip">
<h2><a class="toc-backref" href="#id9">2.2&nbsp;&nbsp;&nbsp;GET /api/v1/ip</a></h2>
<ul class="simple">
<li>Description: basic endpoint that returns the public IP of the caller. If the
API is behind a load balancer, it returns the value of X-Forwarded-For.</li>
<li>Parameters: none</li>
<li>Authentication: none</li>
<li>Response Code: 200 OK</li>
<li>Response: Text</li>
</ul>
<pre class="code bash literal-block">
<span class="name variable">$ </span>curl https://api.mig.mozilla.org/api/v1/ip
108.36.248.44
</pre>
</div>
<div class="section" id="get-api-v1-dashboard">
<h2><a class="toc-backref" href="#id10">2.3&nbsp;&nbsp;&nbsp;GET /api/v1/dashboard</a></h2>
<ul class="simple">
<li>Description: returns a status dashboard with counters of active and idle
agents, and a list of the last 10 actions ran.</li>
<li>Parameters: none</li>
<li>Authentication: X-PGPAUTHORIZATION</li>
<li>Response Code: 200 OK</li>
<li>Response: Collection+JSON</li>
</ul>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.mozilla.org/api/v1/dashboard&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="punctuation">{</span>
          <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;online agents&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1367</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;online agents by version&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                <span class="punctuation">{</span>
                  <span class="name tag">&quot;count&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1366</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;20150122+ad43a11.prod&quot;</span>
                <span class="punctuation">},</span>
                <span class="punctuation">{</span>
                  <span class="name tag">&quot;count&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;20150124+79ecbbb.prod&quot;</span>
                <span class="punctuation">}</span>
                <span class="punctuation">]</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;online endpoints&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1367</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;idle agents&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">23770</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;idle agents by version&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                <span class="punctuation">{</span>
                  <span class="name tag">&quot;count&quot;</span><span class="punctuation">:</span> <span class="literal number integer">23770</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;20150122+ad43a11.prod&quot;</span>
                <span class="punctuation">}</span>
                <span class="punctuation">]</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;idle endpoints&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">5218</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;new endpoints&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">7889</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;endpoints running 2 or more agents&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">0</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;disappeared endpoints&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">48811</span>
          <span class="punctuation">},</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;flapping endpoints&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal number integer">4478</span>
          <span class="punctuation">}</span>
          <span class="punctuation">],</span>
          <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.mozilla.org/api/v1/dashboard&quot;</span>
        <span class="punctuation">},</span>
        <span class="punctuation">{</span>
          <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;action&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                <span class="name tag">&quot;counters&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                  <span class="name tag">&quot;done&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1119</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;inflight&quot;</span><span class="punctuation">:</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;sent&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1121</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1119</span>
                <span class="punctuation">},</span>
                <span class="name tag">&quot;description&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                  <span class="name tag">&quot;author&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Spongebob SquarepantsJeff Bryner&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;email&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;bob&#64;example.net&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;revision&quot;</span><span class="punctuation">:</span> <span class="literal number float">201412311300.0</span>
                <span class="punctuation">},</span>
                <span class="name tag">&quot;expireafter&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-24T14:03:00Z&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;finishtime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;9998-01-11T11:11:11Z&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number float">6.115472790658567e+18</span><span class="punctuation">,</span>
                <span class="name tag">&quot;investigators&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                  <span class="name tag">&quot;createdat&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:38.11369Z&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;lastmodified&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:42.474417Z&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Sher Lock&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;pgpfingerprint&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;E60892BB9BD89A69F759A1A0A3D652173B763E8F&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;active&quot;</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;lastupdatetime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:11.561547Z&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Verify system sends syslog to syslog servers instead of local&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;operations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                  <span class="name tag">&quot;module&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;file&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                        <span class="name tag">&quot;searches&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                        <span class="name tag">&quot;authprivtoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^authpriv\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;/etc&quot;</span>
                          <span class="punctuation">]</span>
                        <span class="punctuation">},</span>
                        <span class="name tag">&quot;daemontoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^daemon\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}.&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;/etc&quot;</span>
                          <span class="punctuation">]</span>
                        <span class="punctuation">},</span>
                        <span class="name tag">&quot;kerntoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^kern\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                          <span class="literal string double">&quot;/etc&quot;</span>
                          <span class="punctuation">]</span>
                        <span class="punctuation">}</span>
                        <span class="punctuation">}</span>
                  <span class="punctuation">}</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;pgpsignatures&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="literal string double">&quot;wsBc.....&quot;</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;starttime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:00.751008Z&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;inflight&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;syntaxversion&quot;</span><span class="punctuation">:</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                <span class="name tag">&quot;target&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;agents.queueloc like 'linux.%' AND tags-&gt;&gt;'operator'='IT'&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;threat&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                  <span class="name tag">&quot;family&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;compliance&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;level&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;medium&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;ref&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;sysmediumlogs1&quot;</span><span class="punctuation">,</span>
                  <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;system&quot;</span>
                <span class="punctuation">},</span>
                <span class="name tag">&quot;validfrom&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:00Z&quot;</span>
                <span class="punctuation">}</span>
          <span class="punctuation">}</span>
          <span class="punctuation">],</span>
          <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/action?actionid=6115472790658567168&quot;</span>
        <span class="punctuation">}</span>
        <span class="punctuation">],</span>
        <span class="name tag">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;1.0&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="get-api-v1-action">
<h2><a class="toc-backref" href="#id11">2.4&nbsp;&nbsp;&nbsp;GET /api/v1/action</a></h2>
<ul>
<li><p class="first">Description: retrieve an action by its ID. Include links to related commands.</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters:</dt>
<dd><ul class="first last simple">
<li><cite>actionid</cite>: a uint64 that identifies an action by its ID</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 200 OK</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
</ul>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/action?actionid=6115472790658567168&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                        <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;action&quot;</span><span class="punctuation">,</span>
                        <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;counters&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                <span class="name tag">&quot;done&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1119</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;inflight&quot;</span><span class="punctuation">:</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;sent&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1121</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1119</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;description&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                <span class="name tag">&quot;author&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Sponge Bob&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;email&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;bob&#64;example.net&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;revision&quot;</span><span class="punctuation">:</span> <span class="literal number float">201412311300.0</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;expireafter&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-24T14:03:00Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;finishtime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;9998-01-11T11:11:11Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number float">6.115472790658567e+18</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;investigators&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                <span class="punctuation">{</span>
                                  <span class="name tag">&quot;createdat&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:38.11369Z&quot;</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;lastmodified&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:42.474417Z&quot;</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Sher Lock&quot;</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;pgpfingerprint&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;E60892BB9BD89A69F759A1A0A3D652173B763E8F&quot;</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;active&quot;</span>
                                <span class="punctuation">}</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;lastupdatetime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:11.561547Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Verify system sends syslog to syslog servers instead of local&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;operations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                <span class="punctuation">{</span>
                                  <span class="name tag">&quot;module&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;file&quot;</span><span class="punctuation">,</span>
                                  <span class="name tag">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                        <span class="name tag">&quot;searches&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                          <span class="name tag">&quot;authprivtoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^authpriv\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                  <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                                                  <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                                                <span class="punctuation">},</span>
                                                <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;/etc&quot;</span>
                                                <span class="punctuation">]</span>
                                          <span class="punctuation">},</span>
                                          <span class="name tag">&quot;daemontoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^daemon\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}.&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                  <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                                                  <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                                                <span class="punctuation">},</span>
                                                <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;/etc&quot;</span>
                                                <span class="punctuation">]</span>
                                          <span class="punctuation">},</span>
                                          <span class="name tag">&quot;kerntoremotesyslog&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                <span class="name tag">&quot;contents&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^kern\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;^r?syslog.conf$&quot;</span>
                                                <span class="punctuation">],</span>
                                                <span class="name tag">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                                  <span class="name tag">&quot;matchall&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
                                                  <span class="name tag">&quot;maxdepth&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
                                                <span class="punctuation">},</span>
                                                <span class="name tag">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                                  <span class="literal string double">&quot;/etc&quot;</span>
                                                <span class="punctuation">]</span>
                                          <span class="punctuation">}</span>
                                        <span class="punctuation">}</span>
                                  <span class="punctuation">}</span>
                                <span class="punctuation">}</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;pgpsignatures&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                <span class="literal string double">&quot;wsBc.....&quot;</span>
                          <span class="punctuation">],</span>
                          <span class="name tag">&quot;starttime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:00.751008Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;inflight&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;syntaxversion&quot;</span><span class="punctuation">:</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;target&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;agents.queueloc like 'linux.%' AND tags-&gt;&gt;'operator'='IT'&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;threat&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                <span class="name tag">&quot;family&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;compliance&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;level&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;medium&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;ref&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;sysmediumlogs1&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;system&quot;</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;validfrom&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T14:03:00Z&quot;</span>
                        <span class="punctuation">}</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/action?actionid=6115472790658567168&quot;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">],</span>
        <span class="name tag">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;1.0&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="post-api-v1-action-create">
<h2><a class="toc-backref" href="#id12">2.5&nbsp;&nbsp;&nbsp;POST /api/v1/action/create/</a></h2>
<ul>
<li><p class="first">Description: send a signed action to the API for submission to the scheduler.</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters: (POST body)</dt>
<dd><ul class="first last simple">
<li><cite>action</cite>: a signed action in JSON format</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 202 Accepted</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
</ul>
</div>
<div class="section" id="get-api-v1-agent">
<h2><a class="toc-backref" href="#id13">2.6&nbsp;&nbsp;&nbsp;GET /api/v1/agent</a></h2>
<ul>
<li><p class="first">Description: retrieve an agent by its ID</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters:</dt>
<dd><ul class="first last simple">
<li><cite>agentid</cite>: a uint64 that identifies an agent by its ID</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 200 OK</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
</ul>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/agent?agentid=1423779015943326976&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                        <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;agent&quot;</span><span class="punctuation">,</span>
                        <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;destructiontime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;0001-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                <span class="name tag">&quot;addresses&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                                  <span class="literal string double">&quot;10.150.75.13/26&quot;</span><span class="punctuation">,</span>
                                  <span class="literal string double">&quot;fe80::813:6bff:fef8:31df/64&quot;</span>
                                <span class="punctuation">],</span>
                                <span class="name tag">&quot;arch&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;amd64&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;ident&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;RedHatEnterpriseServer 6.5 Santiago&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;init&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;upstart&quot;</span><span class="punctuation">,</span>
                                <span class="name tag">&quot;isproxied&quot;</span><span class="punctuation">:</span> <span class="keyword constant">false</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;heartbeatts&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-23T15:00:42.656265Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number float">1.423779015943327e+18</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;syslog1.private.mydomain.example.net&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;pid&quot;</span><span class="punctuation">:</span> <span class="literal number integer">24666</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;queueloc&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;linux.syslog1.private.mydomain.example.net.598f3suaf33ta&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;starttime&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-12T22:10:15.897514Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;online&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                                <span class="name tag">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;IT&quot;</span>
                          <span class="punctuation">},</span>
                          <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;20150122+ad43a11.prod&quot;</span>
                        <span class="punctuation">}</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/agent?agentid=1423779015943326976&quot;</span>
          <span class="punctuation">}</span>
        <span class="punctuation">],</span>
        <span class="name tag">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;1.0&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="get-api-v1-command">
<h2><a class="toc-backref" href="#id14">2.7&nbsp;&nbsp;&nbsp;GET /api/v1/command</a></h2>
<ul>
<li><p class="first">Description: retrieve a command by its ID. Include link to related action.</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters:</dt>
<dd><ul class="first last simple">
<li><cite>commandid</cite>: a uint64 that identifies a command by its ID</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 200 OK</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
</ul>
<pre class="code bash literal-block">
<span class="operator">{</span>
  <span class="literal string double">&quot;collection&quot;</span>: <span class="operator">{</span>
        <span class="literal string double">&quot;error&quot;</span>: <span class="operator">{}</span>,
        <span class="literal string double">&quot;href&quot;</span>: <span class="literal string double">&quot;https://api.mig.example.net/api/v1/command?commandid=1424700180901330688&quot;</span>,
        <span class="literal string double">&quot;items&quot;</span>: <span class="operator">[</span>
          <span class="operator">{</span>
                <span class="literal string double">&quot;data&quot;</span>: <span class="operator">[</span>
                  <span class="operator">{</span>
                        <span class="literal string double">&quot;name&quot;</span>: <span class="literal string double">&quot;command&quot;</span>,
                        <span class="literal string double">&quot;value&quot;</span>: <span class="operator">{</span>
                          <span class="literal string double">&quot;action&quot;</span>: <span class="operator">{</span>
                                <span class="literal string double">&quot;counters&quot;</span>: <span class="operator">{}</span>,
                                <span class="literal string double">&quot;description&quot;</span>: <span class="operator">{</span>
                                  <span class="literal string double">&quot;author&quot;</span>: <span class="literal string double">&quot;Spongebob Squarepants&quot;</span>,
                                  <span class="literal string double">&quot;email&quot;</span>: <span class="literal string double">&quot;bob&#64;example.net&quot;</span>,
                                  <span class="literal string double">&quot;revision&quot;</span>: 201412311300.0
                                <span class="operator">}</span>,
                                <span class="literal string double">&quot;expireafter&quot;</span>: <span class="literal string double">&quot;2015-02-24T14:03:00Z&quot;</span>,
                                <span class="literal string double">&quot;finishtime&quot;</span>: <span class="literal string double">&quot;0001-01-01T00:00:00Z&quot;</span>,
                                <span class="literal string double">&quot;id&quot;</span>: 6.115472790658567e+18,
                                <span class="literal string double">&quot;lastupdatetime&quot;</span>: <span class="literal string double">&quot;0001-01-01T00:00:00Z&quot;</span>,
                                <span class="literal string double">&quot;name&quot;</span>: <span class="literal string double">&quot;Verify system sends syslog to syslog servers instead of local&quot;</span>,
                                <span class="literal string double">&quot;operations&quot;</span>: <span class="operator">[</span>
                                  <span class="operator">{</span>
                                        <span class="literal string double">&quot;module&quot;</span>: <span class="literal string double">&quot;file&quot;</span>,
                                        <span class="literal string double">&quot;parameters&quot;</span>: <span class="operator">{</span>
                                          <span class="literal string double">&quot;searches&quot;</span>: <span class="operator">{</span>
                                                <span class="literal string double">&quot;authprivtoremotesyslog&quot;</span>: <span class="operator">{</span>
                                                  <span class="literal string double">&quot;contents&quot;</span>: <span class="operator">[</span>
                                                        <span class="literal string double">&quot;^authpriv\\.\\*.*&#64;[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}&quot;</span>
                                                  <span class="operator">]</span>,
                                                  <span class="literal string double">&quot;names&quot;</span>: <span class="operator">[</span>
                                                        <span class="literal string double">&quot;^r?syslog.conf</span><span class="name variable">$&quot;</span><span class="literal string double">
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 1
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                },
                                                &quot;</span>daemontoremotesyslog<span class="literal string double">&quot;: {
                                                  &quot;</span>contents<span class="literal string double">&quot;: [
                                                        &quot;</span>^daemon<span class="literal string escape">\\</span>.<span class="literal string escape">\\</span>*.*&#64;<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span>.<span class="literal string double">&quot;
                                                  ],
                                                  &quot;</span>names<span class="literal string double">&quot;: [
                                                        &quot;</span>^r?syslog.conf<span class="literal string double">$&quot;
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 1
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                },
                                                &quot;</span>kerntoremotesyslog<span class="literal string double">&quot;: {
                                                  &quot;</span>contents<span class="literal string double">&quot;: [
                                                        &quot;</span>^kern<span class="literal string escape">\\</span>.<span class="literal string escape">\\</span>*.*&#64;<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string double">&quot;
                                                  ],
                                                  &quot;</span>names<span class="literal string double">&quot;: [
                                                        &quot;</span>^r?syslog.conf<span class="literal string double">$&quot;
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 1
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                }
                                          }
                                        }
                                  }
                                ],
                                &quot;</span>pgpsignatures<span class="literal string double">&quot;: [
                                  &quot;</span>ws....<span class="literal string double">&quot;
                                ],
                                &quot;</span>starttime<span class="literal string double">&quot;: &quot;</span>0001-01-01T00:00:00Z<span class="literal string double">&quot;,
                                &quot;</span>syntaxversion<span class="literal string double">&quot;: 2,
                                &quot;</span>target<span class="literal string double">&quot;: &quot;</span>agents.queueloc like <span class="literal string single">'linux.%'</span> AND tags-&gt;&gt;<span class="literal string single">'operator'</span><span class="operator">=</span><span class="literal string single">'IT'</span><span class="literal string double">&quot;,
                                &quot;</span>threat<span class="literal string double">&quot;: {
                                  &quot;</span>family<span class="literal string double">&quot;: &quot;</span>compliance<span class="literal string double">&quot;,
                                  &quot;</span>level<span class="literal string double">&quot;: &quot;</span>medium<span class="literal string double">&quot;,
                                  &quot;</span>ref<span class="literal string double">&quot;: &quot;</span>sysmediumlogs1<span class="literal string double">&quot;,
                                  &quot;</span><span class="name builtin">type</span><span class="literal string double">&quot;: &quot;</span>system<span class="literal string double">&quot;
                                },
                                &quot;</span>validfrom<span class="literal string double">&quot;: &quot;</span>2015-02-23T14:03:00Z<span class="literal string double">&quot;
                          },
                          &quot;</span>agent<span class="literal string double">&quot;: {
                                &quot;</span>destructiontime<span class="literal string double">&quot;: &quot;</span>0001-01-01T00:00:00Z<span class="literal string double">&quot;,
                                &quot;</span>environment<span class="literal string double">&quot;: {
                                  &quot;</span>isproxied<span class="literal string double">&quot;: false
                                },
                                &quot;</span>heartbeatts<span class="literal string double">&quot;: &quot;</span>0001-01-01T00:00:00Z<span class="literal string double">&quot;,
                                &quot;</span>id<span class="literal string double">&quot;: 1.423779015943327e+18,
                                &quot;</span>mode<span class="literal string double">&quot;: &quot;&quot;,
                                &quot;</span>name<span class="literal string double">&quot;: &quot;</span>syslog1.private.mydomain.example.net<span class="literal string double">&quot;,
                                &quot;</span>queueloc<span class="literal string double">&quot;: &quot;</span>linux.syslog1.private.mydomain.example.net.e98r198dhq<span class="literal string double">&quot;,
                                &quot;</span>starttime<span class="literal string double">&quot;: &quot;</span>0001-01-01T00:00:00Z<span class="literal string double">&quot;,
                                &quot;</span>version<span class="literal string double">&quot;: &quot;</span>20150122+ad43a11.prod<span class="literal string double">&quot;
                          },
                          &quot;</span>finishtime<span class="literal string double">&quot;: &quot;</span>2015-02-23T14:03:10.402108Z<span class="literal string double">&quot;,
                          &quot;</span>id<span class="literal string double">&quot;: 1.4247001809013307e+18,
                          &quot;</span>results<span class="literal string double">&quot;: [
                                {
                                  &quot;</span>elements<span class="literal string double">&quot;: {
                                        &quot;</span>authprivtoremotesyslog<span class="literal string double">&quot;: [
                                          {
                                                &quot;</span>file<span class="literal string double">&quot;: &quot;&quot;,
                                                &quot;</span>fileinfo<span class="literal string double">&quot;: {
                                                  &quot;</span>lastmodified<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>mode<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>size<span class="literal string double">&quot;: 0
                                                },
                                                &quot;</span>search<span class="literal string double">&quot;: {
                                                  &quot;</span>contents<span class="literal string double">&quot;: [
                                                        &quot;</span>^authpriv<span class="literal string escape">\\</span>.<span class="literal string escape">\\</span>*.*&#64;<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string double">&quot;
                                                  ],
                                                  &quot;</span>names<span class="literal string double">&quot;: [
                                                        &quot;</span>^r?syslog.conf<span class="literal string double">$&quot;
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>matchlimit<span class="literal string double">&quot;: 0,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 0
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                }
                                          }
                                        ],
                                        &quot;</span>daemontoremotesyslog<span class="literal string double">&quot;: [
                                          {
                                                &quot;</span>file<span class="literal string double">&quot;: &quot;&quot;,
                                                &quot;</span>fileinfo<span class="literal string double">&quot;: {
                                                  &quot;</span>lastmodified<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>mode<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>size<span class="literal string double">&quot;: 0
                                                },
                                                &quot;</span>search<span class="literal string double">&quot;: {
                                                  &quot;</span>contents<span class="literal string double">&quot;: [
                                                        &quot;</span>^daemon<span class="literal string escape">\\</span>.<span class="literal string escape">\\</span>*.*&#64;<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span>.<span class="literal string double">&quot;
                                                  ],
                                                  &quot;</span>names<span class="literal string double">&quot;: [
                                                        &quot;</span>^r?syslog.conf<span class="literal string double">$&quot;
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>matchlimit<span class="literal string double">&quot;: 0,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 0
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                }
                                          }
                                        ],
                                        &quot;</span>kerntoremotesyslog<span class="literal string double">&quot;: [
                                          {
                                                &quot;</span>file<span class="literal string double">&quot;: &quot;&quot;,
                                                &quot;</span>fileinfo<span class="literal string double">&quot;: {
                                                  &quot;</span>lastmodified<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>mode<span class="literal string double">&quot;: &quot;&quot;,
                                                  &quot;</span>size<span class="literal string double">&quot;: 0
                                                },
                                                &quot;</span>search<span class="literal string double">&quot;: {
                                                  &quot;</span>contents<span class="literal string double">&quot;: [
                                                        &quot;</span>^kern<span class="literal string escape">\\</span>.<span class="literal string escape">\\</span>*.*&#64;<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string escape">\\</span>.<span class="operator">[</span>0-9<span class="operator">]{</span>1,3<span class="operator">}</span><span class="literal string double">&quot;
                                                  ],
                                                  &quot;</span>names<span class="literal string double">&quot;: [
                                                        &quot;</span>^r?syslog.conf<span class="literal string double">$&quot;
                                                  ],
                                                  &quot;</span>options<span class="literal string double">&quot;: {
                                                        &quot;</span>matchall<span class="literal string double">&quot;: true,
                                                        &quot;</span>matchlimit<span class="literal string double">&quot;: 0,
                                                        &quot;</span>maxdepth<span class="literal string double">&quot;: 0
                                                  },
                                                  &quot;</span>paths<span class="literal string double">&quot;: [
                                                        &quot;</span>/etc<span class="literal string double">&quot;
                                                  ]
                                                }
                                          }
                                        ]
                                  },
                                  &quot;</span>errors<span class="literal string double">&quot;: null,
                                  &quot;</span>foundanything<span class="literal string double">&quot;: false,
                                  &quot;</span>statistics<span class="literal string double">&quot;: {
                                        &quot;</span>exectime<span class="literal string double">&quot;: &quot;</span>20.968752ms<span class="literal string double">&quot;,
                                        &quot;</span>filescount<span class="literal string double">&quot;: 140,
                                        &quot;</span>openfailed<span class="literal string double">&quot;: 0,
                                        &quot;</span>totalhits<span class="literal string double">&quot;: 0
                                  },
                                  &quot;</span>success<span class="literal string double">&quot;: true
                                }
                          ],
                          &quot;</span>starttime<span class="literal string double">&quot;: &quot;</span>2015-02-23T14:03:00.901331Z<span class="literal string double">&quot;,
                          &quot;</span>status<span class="literal string double">&quot;: &quot;</span>success<span class="literal string double">&quot;
                        }
                  }
                ],
                &quot;</span>href<span class="literal string double">&quot;: &quot;</span>https://api.mig.example.net/api/v1/command?commandid<span class="operator">=</span>1424700180901330688<span class="literal string double">&quot;,
                &quot;</span>links<span class="literal string double">&quot;: [
                  {
                        &quot;</span>href<span class="literal string double">&quot;: &quot;</span>https://api.mig.example.net/api/v1/action?actionid<span class="operator">=</span>6115472790658567168<span class="literal string double">&quot;,
                        &quot;</span>rel<span class="literal string double">&quot;: &quot;</span>action<span class="literal string double">&quot;
                  }
                ]
          }
        ],
        &quot;</span>template<span class="literal string double">&quot;: {},
        &quot;</span>version<span class="literal string double">&quot;: &quot;</span>1.0<span class="literal string double">&quot;
  }
}</span>
</pre>
</div>
<div class="section" id="get-api-v1-investigator">
<h2><a class="toc-backref" href="#id15">2.8&nbsp;&nbsp;&nbsp;GET /api/v1/investigator</a></h2>
<ul>
<li><p class="first">Description: retrieve an investigator by its ID. Include link to the
investigator's action history.</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters:</dt>
<dd><ul class="first last simple">
<li><cite>investigatorid</cite>: a uint64 that identifies a command by its ID</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 200 OK</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
</ul>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/investigator?investigatorid=1&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
          <span class="punctuation">{</span>
                <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                        <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;investigator&quot;</span><span class="punctuation">,</span>
                        <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                          <span class="name tag">&quot;createdat&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:38.11369Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;id&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;lastmodified&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2014-11-01T19:35:42.474417Z&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Julien Vehent&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;pgpfingerprint&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;E60892BB9BD89A69F759A1A0A3D652173B763E8F&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;publickey&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWS.........&quot;</span><span class="punctuation">,</span>
                          <span class="name tag">&quot;status&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;active&quot;</span>
                        <span class="punctuation">}</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">],</span>
                <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/investigator?investigatorid=1&quot;</span><span class="punctuation">,</span>
                <span class="name tag">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
                  <span class="punctuation">{</span>
                        <span class="name tag">&quot;href&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/search?type=action&amp;investigatorid=1&amp;limit=100&quot;</span><span class="punctuation">,</span>
                        <span class="name tag">&quot;rel&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;investigator history&quot;</span>
                  <span class="punctuation">}</span>
                <span class="punctuation">]</span>
          <span class="punctuation">}</span>
        <span class="punctuation">],</span>
        <span class="name tag">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;1.0&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
</div>
<div class="section" id="post-api-v1-investigator-create">
<h2><a class="toc-backref" href="#id16">2.9&nbsp;&nbsp;&nbsp;POST /api/v1/investigator/create/</a></h2>
<ul>
<li><p class="first">Description: create a new investigator in the database</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters: (POST body)</dt>
<dd><ul class="first last simple">
<li><cite>name</cite>: string that represents the full name</li>
<li><cite>publickey</cite>: armored GPG public key</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 201 Created</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
<li><p class="first">Example: (without authentication)</p>
</li>
</ul>
<pre class="code bash literal-block">
<span class="name variable">$ </span>gpg --export -a --export-options <span class="name builtin">export</span>-minimal bob_kelso&#64;example.net &gt; /tmp/bobpubkey
<span class="name variable">$ </span>curl -iv -F <span class="literal string double">&quot;name=Bob Kelso&quot;</span> -F <span class="name variable">publickey</span><span class="operator">=</span>&#64;/tmp/pubkey https://api.mig.example.net/api/v1/investigator/create/
</pre>
</div>
<div class="section" id="post-api-v1-investigator-update">
<h2><a class="toc-backref" href="#id17">2.10&nbsp;&nbsp;&nbsp;POST /api/v1/investigator/update/</a></h2>
<ul>
<li><p class="first">Description: update an existing investigator in the database</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><dl class="first docutils">
<dt>Parameters: (POST body)</dt>
<dd><ul class="first last simple">
<li><cite>id</cite>: investigator id, to identify the target investigator</li>
<li><cite>status</cite>: new status of the investigator, to be updated</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Response Code: 201 Created</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
<li><p class="first">Example: (without authentication)</p>
</li>
</ul>
<pre class="code bash literal-block">
<span class="name variable">$ </span>curl -iv -X POST -d <span class="name variable">id</span><span class="operator">=</span><span class="literal number">1234</span> -d <span class="name variable">status</span><span class="operator">=</span>disabled https://api.mig.example.net/api/v1/investigator/update/
</pre>
</div>
<div class="section" id="get-api-v1-search">
<h2><a class="toc-backref" href="#id18">2.11&nbsp;&nbsp;&nbsp;GET /api/v1/search</a></h2>
<ul>
<li><p class="first">Description: search for actions, commands, agents or investigators.</p>
</li>
<li><p class="first">Authentication: X-PGPAUTHORIZATION</p>
</li>
<li><p class="first">Response Code: 200 OK</p>
</li>
<li><p class="first">Response: Collection+JSON</p>
</li>
<li><dl class="first docutils">
<dt>Parameters:</dt>
<dd><ul class="first last">
<li><p class="first"><cite>type</cite>: define the type of item returned by the search.
Valid types are: <cite>action</cite>, <cite>command</cite>, <cite>agent</cite> or <cite>investigator</cite>.</p>
<blockquote>
<ul class="simple">
<li><cite>action</cite>: (default) return a list of actions</li>
<li><cite>command</cite>: return a list of commands</li>
<li><cite>agent</cite>: return a list of agents that have shown activity</li>
<li><cite>investigator</cite>: return a list of investigators that have show activity</li>
</ul>
</blockquote>
</li>
<li><p class="first"><cite>actionid</cite>: filter results on numeric action ID</p>
</li>
<li><p class="first"><cite>actionname</cite>: filter results on string action name, accept <cite>ILIKE</cite> pattern</p>
</li>
<li><p class="first"><cite>after</cite>: return results recorded after this RFC3339 date, depends on type:</p>
<blockquote>
<ul class="simple">
<li><cite>action</cite>: select actions with a <cite>validfrom</cite> date greater than
<cite>after</cite>. Default is last 7 days.</li>
<li><cite>agent</cite>: select agents that have sent a heartbeat since <cite>after</cite>.
Default is last 7 days.</li>
<li><cite>command</cite>: select commands with a <cite>starttime</cite> date greated than
<cite>after</cite>. Default is last 7 days.</li>
<li><cite>investigator</cite>: select investigators with a <cite>createdat</cite> date greater
than <cite>after</cite>. Default is last 1,000 years.</li>
</ul>
</blockquote>
</li>
<li><p class="first"><cite>agentid</cite>: filter results on the agent ID</p>
</li>
<li><p class="first"><cite>agentname</cite>: filter results on string agent name, accept <cite>ILIKE</cite> pattern</p>
</li>
<li><p class="first"><cite>before</cite>: return results recorded before this RFC3339 date. If not defined,
default is to retrieve results until now.</p>
<blockquote>
<ul class="simple">
<li><cite>action</cite>: select actions with a <cite>expireafter</cite> date lower than <cite>before</cite></li>
<li><cite>agent</cite>: select agents that have sent a heartbeat priot to <cite>before</cite></li>
<li><cite>command</cite>: select commands with a <cite>starttime</cite> date lower than <cite>before</cite></li>
<li><cite>investigator</cite>: select investigators with a <cite>lastmodified</cite> date lower
than <cite>before</cite></li>
</ul>
</blockquote>
</li>
<li><p class="first"><cite>commandid</cite>: filter results on the command ID</p>
</li>
<li><p class="first"><cite>foundanything</cite>: filter commands on the <cite>foundanything</cite> boolean of their
results (only for type <cite>command</cite>, as it requires looking into results)</p>
</li>
<li><p class="first"><cite>investigatorid</cite>: filter results on the investigator ID</p>
</li>
<li><p class="first"><cite>investigatorname</cite>: filter results on string investigator name, accept
<cite>ILIKE</cite> pattern</p>
</li>
<li><p class="first"><cite>limit</cite>: limit the number of results to 10,000 by default</p>
</li>
<li><p class="first"><cite>offset</cite>: discard the X first results, defaults to 0. Used in conjunction
with <cite>limit</cite>, offset can be used to paginate search results.
ex: <strong>&amp;limit=10&amp;offset=50</strong> will grab 10 results discarding the first 50.</p>
</li>
<li><dl class="first docutils">
<dt><cite>report</cite>: if set, return results in the given report format:</dt>
<dd><ul class="first last simple">
<li><cite>complianceitems</cite> returns command results as compliance items</li>
<li><cite>geolocations</cite> returns command results as geolocation endpoints</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><cite>status</cite>: filter on internal status, accept <cite>ILIKE</cite> pattern.
Status depends on the type. Below are the available statuses per type:</p>
<blockquote>
<ul class="simple">
<li><cite>action</cite>: pending, scheduled, preparing, invalid, inflight, completed</li>
<li><cite>agent</cite>: online, upgraded, destroyed, offline, idle</li>
<li><cite>command</cite>: prepared, sent, success, timeout, cancelled, expired, failed</li>
<li><cite>investigator</cite>: active, disabled</li>
</ul>
</blockquote>
</li>
<li><p class="first"><cite>target</cite>: returns agents that match a target query (only for <cite>agent</cite> type)</p>
</li>
<li><p class="first"><cite>threatfamily</cite>: filter results of the threat family of the action, accept
<cite>ILIKE</cite> pattern (only for types <cite>command</cite> and <cite>action</cite>)</p>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>`ILIKE` pattern</strong></p>
<p>Some search parameters accept Postgres's pattern matching syntax. For these
parameters, the value is used as a SQL <cite>ILIKE</cite> search pattern, as described in
<a class="reference external" href="http://www.postgresql.org/docs/9.4/static/functions-matching.html">Postgres's documentation</a>.</p>
<p>Note: URL encoding transform the <strong>%</strong> character into <strong>%25</strong>, its ASCII value.</p>
<ul class="simple">
<li>Examples:</li>
</ul>
<p>Generate a compliance report from <cite>compliance</cite> action ran over the last 24
hours. For more information on the <cite>compliance</cite> format, see section 2.</p>
<pre class="code bash literal-block">
/api/v1/search?type<span class="operator">=</span><span class="name builtin">command</span><span class="punctuation">&amp;</span><span class="name variable">threatfamily</span><span class="operator">=</span>compliance<span class="punctuation">&amp;</span><span class="name variable">status</span><span class="operator">=</span><span class="keyword">done</span>
<span class="punctuation">&amp;</span><span class="name variable">report</span><span class="operator">=</span>complianceitems<span class="punctuation">&amp;</span><span class="name variable">limit</span><span class="operator">=</span>100000
<span class="punctuation">&amp;</span><span class="name variable">after</span><span class="operator">=</span>2014-05-30T00:00:00-04:00<span class="punctuation">&amp;</span><span class="name variable">before</span><span class="operator">=</span>2014-05-30T23:59:59-04:00
</pre>
<p>List the agents that have sent a heartbeat in the last hour.</p>
<pre class="code bash literal-block">
/api/v1/search?type<span class="operator">=</span>agent<span class="punctuation">&amp;</span><span class="name variable">after</span><span class="operator">=</span>2014-05-30T15:00:00-04:00<span class="punctuation">&amp;</span><span class="name variable">limit</span><span class="operator">=</span>200
</pre>
<p>Find actions ran between two dates (limited to 10 results as is the default).</p>
<pre class="code bash literal-block">
/api/v1/search?type<span class="operator">=</span>action<span class="punctuation">&amp;</span><span class="name variable">status</span><span class="operator">=</span>sent
<span class="punctuation">&amp;</span><span class="name variable">after</span><span class="operator">=</span>2014-05-01T00:00:00-00:00<span class="punctuation">&amp;</span><span class="name variable">before</span><span class="operator">=</span>2014-05-30T00:00:00-00:00
</pre>
<p>Find the last 10 commands signed by an investigator identified by name.</p>
<pre class="code bash literal-block">
/api/v1/search?investigatorname<span class="operator">=</span>%25bob%25smith%25<span class="punctuation">&amp;</span><span class="name variable">limit</span><span class="operator">=</span>10<span class="punctuation">&amp;</span><span class="name builtin">type</span><span class="operator">=</span><span class="name builtin">command</span>
</pre>
</div>
</div>
<div class="section" id="data-transformation">
<h1><a class="toc-backref" href="#id19">3&nbsp;&nbsp;&nbsp;Data transformation</a></h1>
<p>The API implements several data transformation functions between the base
format of <cite>action</cite> and <cite>command</cite>, and reporting formats.</p>
<div class="section" id="compliance-items">
<h2><a class="toc-backref" href="#id20">3.1&nbsp;&nbsp;&nbsp;Compliance Items</a></h2>
<p>The compliance item format is used to measure the compliance of a target with
particular requirement. A single compliance item represent the compliance of
one target (host) with one check (test + value).</p>
<p>In MIG, an <cite>action</cite> can contain compliance checks. An <cite>action</cite> creates one
<cite>command</cite> per <cite>agent</cite>. Upon completion, the agent stores the results in the
<cite>command.results</cite>. To visualize the results of an action, an investigator must
look at the results of each command generated by that action.</p>
<p>To generate compliance items, the API takes the results from commands, and
creates one item per result. Therefore, a single action that creates hundreds of
commands could, in turn, generate thousands of compliance items.</p>
<p>The format for compliance items is simple, to be easily graphed and aggregated.</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;target&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;server1.mydomain.example.net&quot;</span><span class="punctuation">,</span>
  <span class="name tag">&quot;utctimestamp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;2015-02-19T02:59:30.203004Z&quot;</span><span class="punctuation">,</span>
  <span class="name tag">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;IT&quot;</span>
  <span class="punctuation">},</span>
  <span class="name tag">&quot;compliance&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
  <span class="name tag">&quot;link&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://api.mig.example.net/api/v1/command?commandid=1424314751392165120&quot;</span><span class="punctuation">,</span>
  <span class="name tag">&quot;policy&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;url&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;https://wiki.example.net/ComplianceDoc/IT+System+security+guidelines&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;system&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;level&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;low&quot;</span>
  <span class="punctuation">},</span>
  <span class="name tag">&quot;check&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;file&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;value&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;content='^-w /var/spool/cron/root -p wa'&quot;</span>
        <span class="punctuation">},</span>
        <span class="name tag">&quot;location&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;/etc/audit/audit.rules&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;ref&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;syslowaudit1&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;description&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;compliance check for auditd&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;attemptstoaltercrontab_user_config&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
<p>When using the parameter <cite>&amp;report=complianceitems</cite>, the <cite>search</cite> endpoint of the API
will generate a list of compliance items from the results of the search.</p>
</div>
<div class="section" id="geolocations">
<h2><a class="toc-backref" href="#id21">3.2&nbsp;&nbsp;&nbsp;Geolocations</a></h2>
<p>The geolocations format transforms command results into an array of geolocated
endpoints for consumption by a map, like Google Maps. The format discards
results details, and only stores the value of FoundAnything.</p>
<p>This feature requires using <strong>MaxMind's GeoIP2-City</strong> database. The database
must be configured in the API as follow:</p>
<pre class="code literal-block">
[maxmind]
        path = &quot;/etc/mig/GeoIP2-City.mmdb&quot;
</pre>
<p>Geolocations are returned as CLJS items in this format:</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
        <span class="name tag">&quot;actionid&quot;</span><span class="punctuation">:</span> <span class="literal number float">1.4271242660295127e+18</span><span class="punctuation">,</span>
        <span class="name tag">&quot;city&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Absecon&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;commandid&quot;</span><span class="punctuation">:</span> <span class="literal number float">1.427124243673173e+18</span><span class="punctuation">,</span>
        <span class="name tag">&quot;country&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;United States&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;endpoint&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;somehost.example.net&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;foundanything&quot;</span><span class="punctuation">:</span> <span class="keyword constant">true</span><span class="punctuation">,</span>
        <span class="name tag">&quot;latitude&quot;</span><span class="punctuation">:</span> <span class="literal number float">39.4284</span><span class="punctuation">,</span>
        <span class="name tag">&quot;longitude&quot;</span><span class="punctuation">:</span> <span class="literal number float">-74.4957</span>
<span class="punctuation">}</span>
</pre>
<p>When using the parameter <cite>&amp;report=geolocations</cite>, the <cite>search</cite> endpoint of the
API will generate a list of geolocations from the results of the search.</p>
</div>
</div>
</div>
</body>
</html>
